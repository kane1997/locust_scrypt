# Locust

<aside>
ğŸ’¡ Locustæ˜¯ä¸€æ¬¾PythonæŠ€æœ¯æ ˆçš„å¼€æºçš„æ€§èƒ½æµ‹è¯•å·¥å…·ã€‚Locustç›´è¯‘ä¸ºè—è™«ï¼Œå¯“æ„ç€å®ƒèƒ½äº§ç”Ÿè—è™«èˆ¬æˆåƒä¸Šä¸‡çš„å¹¶å‘ç”¨æˆ·ï¼š
Locustæ˜¯å¼€æºã€ä½¿ç”¨Pythonå¼€å‘ã€åŸºäºäº‹ä»¶ã€æ”¯æŒåˆ†å¸ƒå¼å¹¶ä¸”æä¾›Web UIè¿›è¡Œæµ‹è¯•æ‰§è¡Œå’Œç»“æœå±•ç¤ºçš„æ€§èƒ½æµ‹è¯•å·¥å…·ã€‚

Locustä½¿ç”¨Pythonä»£ç å®šä¹‰æµ‹è¯•åœºæ™¯ï¼Œç›®å‰æ”¯æŒPython 2.7ä»¥ä¸Šç‰ˆæœ¬ã€‚å®ƒè‡ªå¸¦ä¸€ä¸ªWeb UI,ç”¨äºå®šä¹‰ç”¨æˆ·æ¨¡å‹ï¼Œå‘èµ·æµ‹è¯•ï¼Œå®æ—¶æµ‹è¯•æ•°æ®ï¼Œé”™è¯¯ç»Ÿè®¡ç­‰ï¼Œåœ¨æœ€æ–°æœªæ­£å¼å‘å¸ƒçš„v0.8a2(å½“å‰æœ€æ–°å‘å¸ƒç‰ˆæœ¬v0.8a1)ï¼Œè¿˜æä¾›QPSã€è¯„ä»·å“åº”æ—¶é—´ç­‰å‡ ä¸ªç®€å•çš„å›¾è¡¨ã€‚

</aside>

## å®‰è£…

1. å®‰è£…Python3.8åŠä»¥ä¸Šç‰ˆæœ¬
2. pip install locust
3. locust -V , ç›®å‰æ˜¯2.8.4ç‰ˆæœ¬

## ç»„ä»¶æ„æˆ

<aside>
ğŸ’¡ Locustï¼šå¦‚æœè¯´æ¡†æ¶è¿›è¡Œå‹åŠ›æµ‹è¯•çš„æ–¹å¼æ˜¯ç”¨ä¸€ç¾¤è—è™«è¿›è¡Œè¿›æ”»ï¼Œé‚£ä¹ˆLocustç±»ç›¸å½“äºä¸€ä¸ªè—è™«æ¨¡æ¿ï¼Œè€Œæ¯ä¸€ä¸ªlocustå®ä¾‹å°±ç›¸å½“äºå…¶ä¸­çš„ä¸€ä¸ªè—è™«ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç”¨æˆ·ã€ä¸€ä¸ªçº¿ç¨‹......ã€‚å› æ­¤å½“æˆ‘ä»¬ä½¿ç”¨æ¡†æ¶è¿›è¡Œå‹åŠ›æµ‹è¯•æ—¶ï¼Œ*è‡³å°‘*éœ€è¦å­˜åœ¨ä¸€ä¸ªLocustç±»ï¼Œåœ¨æŒ‡å®šäº†æ¨¡æ‹Ÿç”¨æˆ·çš„ä¸ªæ•°åï¼Œæ¡†æ¶å°±ä¼šå®ä¾‹åŒ–ç›¸åº”å¤šçš„Locustå¯¹è±¡ï¼Œä»è€Œå®ç°å¯¹ç”¨æˆ·çš„æ¨¡æ‹Ÿã€‚

- TaskSetï¼šæµ‹è¯•åœºæ™¯ï¼Œæ˜¯ç”±ä¸€ç³»åˆ—çš„ä»»åŠ¡ç»„æˆã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ç¾¤è—è™«æ¥è¿›æ”»ç½‘ç«™ï¼Œä½†æ˜¯å¦‚æœè—è™«ä¸çŸ¥é“è¿›æ”»è°æ€ä¹ˆè¿›æ”»é‚£ä¹Ÿæ˜¯ç™½è´¹åŠ›æ°”ï¼Œå› æ­¤å¯¹è—è™«ï¼ˆæ¨¡æ‹Ÿç”¨æˆ·ï¼‰æˆ‘ä»¬éœ€è¦å‘Šè¯‰å®ƒä»¬æ‰§è¡Œçš„ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä¸ºæ¯ä¸ªLocustæŒ‡å®štask_set
- HttpUser: ç”¨äºå‘é€httpè¯·æ±‚ï¼Œå°è£…äº†get post deleteç­‰httpå¸¸ç”¨å‘½ä»¤
- taskï¼šä»»åŠ¡ï¼Œæ˜¯TaskSetçš„ä¸€ä¸ªæœ€å°å•ä½
- clientï¼šå®¢æˆ·ç«¯ï¼Œç”±äºæ¡†æ¶ä¸»è¦æ˜¯ç”¨äºå‘websiteå‘åŠ¨è¿›æ”»ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆå¯ä»¥æ˜¯Httpçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯WebSocketç­‰ç­‰ï¼‰ã€‚å®¢æˆ·ç«¯åœ¨Locustä¸­è¢«æŒ‡å®šï¼Œç„¶åä¼šè¢«ä¼ é€’åˆ°TaskSetä¸­ï¼Œå› æ­¤åœ¨TaskSetå¯ä»¥ç›´æ¥ä½¿ç”¨self.clientè¿›è¡Œæ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶ã€‚
</aside>

## å‚è€ƒæ•™å­¦è§†é¢‘

[https://www.youtube.com/watch?v=sPQjXbtIu68&ab_channel=PegasusWang](https://www.youtube.com/watch?v=sPQjXbtIu68&ab_channel=PegasusWang)

## è„šæœ¬ä»£ç ï¼ˆMVNOï¼‰

### ç›¸å…³è„šæœ¬é¡¹ç›®æ–‡ä»¶ï¼š

[GitHub - kane1997/locust_scrypt](https://github.com/kane1997/locust_scrypt)

```python
from locust import HttpUser, task, between

class QuickstartUser(HttpUser):
    wait_time = between(1, 2.5)
    host = "https://konec-mvno-web-cpjfbnt2q-oppo-dev.vercel.app/"   #å®šä¹‰ä¸»æœº

    @task(1)
    def my_1_task(self):
        self.client.get("/support")   #è¯·æ±‚supporté¡µé¢

    @task(2)
    def my_2_task(self):
        self.client.get("/plans")     #è¯·æ±‚But a plané¡µé¢

    @task(3)
    def my_3_task(self):
        self.client.get("/coverage")   #è¯·æ±‚coverageé¡µé¢

    @task(4)
    def my_4_task(self):
        self.client.get("/about")     #è¯·æ±‚Why usé¡µé¢

    @task(5)
    def login(self):
        self.client.post(
            "/api/auth/login", {"username": "konecau002@gmail.com", "password": "Sps@123456"})

    @task(6)
    def my_6_task(self):
        self.client.get("/_next/data/5sSK9Ibf6E-Zf9cIdOh68/activation.json")

    if __name__=='__main__':         #è¿è¡Œå‡½æ•°
        import os
        os.system('locust -f aaa.py')
```

### æµ‹è¯•è„šæœ¬æ³¨é‡Š

- task_setï¼šæˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªè—è™«æŒ‡å®šä»»åŠ¡é›†ï¼Œå¦åˆ™åœ¨è¿™ä¸ªè—è™«å¯åŠ¨ä¹‹åï¼Œå®ƒéƒ½ä¸çŸ¥é“åº”è¯¥åšä»€ä¹ˆï¼Œå› æ­¤task_setå±æ€§æ˜¯å¿…é¡»çš„
- min_waitã€max_waitï¼šæ¯ä¸ªä»»åŠ¡æ‰§è¡Œååˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå‰çš„æœ€å°/æœ€å¤§ç­‰å¾…æ—¶é—´
- hostï¼šå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„ä¸»æœºåœ°å€
- wait_functionï¼šä¸€ä¸ªç”¨äºè·å–ä»»åŠ¡é—´ç­‰å¾…æ—¶é•¿çš„å‡½æ•°ï¼Œé»˜è®¤æ˜¯min_waitå’Œmax_waitä¸­çš„éšæœºå€¼
- stop_timeoutï¼šLocuståœæ­¢çš„ç§’æ•°ï¼Œå¦‚æœä¸ºNoneï¼Œå°†ä¸åœæ­¢ä¸€ç›´æ‰§è¡Œä»»åŠ¡
- betweenï¼šç”¨äºåŠ è½½ç­‰å¾…æ—¶é—´

## WEB.io çª—å£

- è¿è¡Œåè¿›å…¥webçª—å£è¿›è¡Œæµ‹è¯•ï¼š
- localhost:8089
- æˆ–è€…ï¼šhttp://0.0.0.0:8089

![æˆªå±2022-03-31 15.13.04.png](Locust%208fa1a/%E6%88%AA%E5%B1%8F2022-03-31_15.13.04.png)

## æµ‹è¯•ç»“æœå±•ç¤º

<aside>
ğŸ’¡ æµ‹è¯•ç»“æœå¯ä»¥å±•ç¤ºå¦‚ä¸‹ä¿¡æ¯ï¼š
**Request, Fails, Median response time ,Average response time, min&max response time, Current RPSç­‰ä¿¡æ¯**

</aside>

<aside>
ğŸ’¡ æµ‹è¯•å¼€å§‹åï¼Œé¡µé¢ä¸­ä¼šå¯¹æ¶ˆæ¯è¯·æ±‚è¿›è¡Œç»Ÿè®¡ï¼Œæˆ‘ä»¬æ®æ­¤å¯è·å¾—è¢«æµ‹ç½‘ç«™çš„rpsã€å“åº”æ—¶é—´ç­‰ç­‰ï¼Œä»è€Œå¯¹è¢«æµ‹ç³»ç»Ÿè¿›è¡Œæ€§èƒ½ä¸Šçš„åˆ†æã€‚åœ¨Chartsä¸­å¯ä»¥çœ‹åˆ°å›¾è¡¨åŒ–çš„æ•°æ®è¶‹åŠ¿ï¼›åœ¨Failureså’ŒExceptionsä¸­ï¼Œèƒ½å¤Ÿçœ‹åˆ°æ¶ˆæ¯å‘é€å¤±è´¥æˆ–æ‰§è¡Œä»»åŠ¡å¼‚å¸¸çš„å…·ä½“ä¿¡æ¯ï¼›åœ¨Download Dataä¸­å¯ä»¥å¯¹ç»Ÿè®¡ç»“æœè¿›è¡Œä¸‹è½½ã€‚
****

</aside>

![Figure 3:Demo from Locust web.io](Locust%208fa1a/Untitled.png)

Figure 3:Demo from Locust web.io